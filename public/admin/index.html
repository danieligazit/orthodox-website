<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
</head>
<body>
  <!-- 1. Flag manual init -->
  <script>window.CMS_MANUAL_INIT = true;</script>
  
  <!-- 2. Load NEWER script version -->
  <script src="https://unpkg.com/decap-cms@3.3.3/dist/decap-cms.js"></script>
  
  <!-- 3. Init -->
  <script>
    console.log('Initializing CMS manually...');
    CMS.init({
      load_config_file: false,
      config: {
        backend: {
          name: 'github',
          repo: 'danieligazit/orthodox-website',
          branch: 'main',
          auth_type: 'pkce', // This is the key
          app_id: 'Ov23liBCC2xuzIwQ3irZ',
        },
        // Force the URL to be empty so it doesn't default to Netlify?
        // No, pkce should handle it.
        
        media_folder: "public",
        public_folder: "",
        collections: [
          {
            name: "data",
            label: "Data",
            files: [
              {
                name: "albums",
                label: "Albums",
                file: "src/data/albums.json",
                description: "List of albums",
                fields: [
                  { label: "Albums", name: "albums", widget: "list", fields: [
                      { label: "ID", name: "id", widget: "number", value_type: "int" },
                      { label: "URL Path (Slug)", name: "urlPath", widget: "string", hint: "e.g. 'turn-of-a-millstone'" },
                      { label: "Artist", name: "artist", widget: "string" },
                      { label: "Title", name: "title", widget: "string" },
                      { label: "Release Date", name: "releaseDate", widget: "datetime", format: "YYYY-MM-DD", date_format: "YYYY-MM-DD", time_format: false },
                      { label: "Cover Image", name: "cover", widget: "image", choose_url: false, media_library: { config: { multiple: false } } },
                      { label: "Bandcamp Embed ID", name: "bandcampEmbedId", widget: "number", value_type: "int", required: false },
                      { label: "Description", name: "description", widget: "object", fields: [
                          { label: "Paragraphs", name: "paragraphs", widget: "list", summary: "{{fields.paragraph}}", field: { label: "Paragraph", name: "paragraph", widget: "text" } },
                          { label: "Credits", name: "credits", widget: "object", fields: [
                              { label: "Artists", name: "artists", widget: "list", required: false, field: { label: "Line", name: "line", widget: "string" } },
                              { label: "Additional", name: "additional", widget: "list", required: false, field: { label: "Line", name: "line", widget: "string" } },
                              { label: "Production", name: "production", widget: "list", required: false, field: { label: "Line", name: "line", widget: "string" } },
                              { label: "Cover Art Credits", name: "coverArt", widget: "list", required: false, field: { label: "Line", name: "line", widget: "string" } }
                          ]}
                      ]}
                  ]}
                ]
              }
            ]
          }
        ]
      }
    });
  </script>
</body>
</html>